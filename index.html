<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusCut</title>
    
    <!-- External Libraries & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns"></script>
    
    <!-- Firebase Libraries (Compat Version) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #020617; background-image: url('https://images.unsplash.com/photo-1554141323-945842494587?q=80&w=2594&auto=format&fit=crop'); background-size: cover; background-position: center; background-attachment: fixed; min-height: 100vh; transition: background-image 0.5s ease-in-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.5); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 0.7); }
        .glass-panel { background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { position: relative; background-color: rgba(30, 41, 59, 0.5); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.07); transition: all 0.3s; }
        .glass-card:hover { border-color: rgba(99, 102, 241, 0.5) !important; transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .nav-btn { background-color: rgba(51, 65, 85, 0.5); color: #9CA3AF; backdrop-filter: blur(4px); }
        .nav-btn:hover { background-color: rgba(71, 85, 105, 0.7); color: white; }
        .nav-btn.nav-btn-active { background-color: #4f46e5; color: white; }
        .nav-btn.nav-btn-active:hover { background-color: #4338ca; }
        .modal-panel, .side-panel { transition: all 0.3s ease-out; }
        .priority-mendesak { border-left: 4px solid #EF4444 !important; }
        .priority-penting { border-left: 4px solid #F59E0B !important; }
        .priority-biasa { border-left: 4px solid #3B82F6 !important; }
        #focus-bar { z-index: 100; }
        body.comments-open #focus-bar { display: none; }
        .loader { border: 4px solid rgba(255, 255, 255, 0.2); border-left-color: #4f46e5; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .profile-pic-loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        
        .card-actions { position: absolute; top: 8px; right: 8px; display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
        .glass-card:hover .card-actions { opacity: 1; }
        .action-btn { background-color: rgba(15, 23, 42, 0.7); border-radius: 9999px; padding: 6px; line-height: 0; color: #9CA3AF; cursor: pointer; }
        .action-btn:hover { background-color: rgba(51, 65, 85, 1); color: white; }
        .task-column.drag-over { background-color: rgba(99, 102, 241, 0.1); border: 1px dashed rgba(99, 102, 241, 0.5); }
        .task-card.dragging { opacity: 0.5; transform: scale(1.05); box-shadow: 0 20px 30px rgba(0,0,0,0.3); cursor: grabbing; }
        .task-card { cursor: grab; }

        .kanban-scroll-container { position: relative; }
        .kanban-scroll-wrapper { overflow-x: auto; padding-bottom: 1rem; }
        .scroll-btn { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); color: white; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 9999px; width: 40px; height: 40px; display: none; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; z-index: 20; }
        .scroll-btn:hover { background-color: #4f46e5; }
        #scroll-left-btn { left: -20px; }
        #scroll-right-btn { right: -20px; }
        @media (min-width: 1024px) { .scroll-btn { display: flex; } }
        
        /* Dropdown Styles */
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: rgba(30, 41, 59, 0.9); backdrop-filter: blur(8px); min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; border-radius: 0.5rem; border: 1px solid rgba(255, 255, 255, 0.1); padding: 0.5rem 0; }
        .dropdown-content a { color: #E5E7EB; padding: 0.75rem 1rem; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; }
        .dropdown-content a:hover { background-color: rgba(71, 85, 105, 0.5); }
        .dropdown:hover .dropdown-content { display: block; }
    </style>
</head>
<body class="text-white">

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-panel rounded-2xl p-8 text-center max-w-md w-full">
            <img src="https://i.imgur.com/2z2b0so.jpeg" alt="FocusCut Logo" class="w-24 h-24 rounded-full object-cover mx-auto mb-4 border-2 border-white/20">
            <h1 class="text-3xl font-bold text-white mb-2" data-translate-key="productName">FocusCut</h1>
            <p class="text-gray-300 mb-6" data-translate-key="loginSubtitle">Masuk untuk melanjutkan ke dasbor Anda.</p>
            <div id="login-error-message" class="hidden text-left text-sm bg-red-900/50 text-red-300 p-3 rounded-lg mb-4"></div>
            <button id="google-login-btn" class="w-full flex items-center justify-center gap-3 bg-white hover:bg-gray-200 text-gray-800 font-semibold py-3 px-4 rounded-lg shadow-md transition-all duration-300">
                <svg class="w-6 h-6" viewBox="0 0 48 48"><path fill="#4285F4" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#34A853" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l5.657,5.657C40.074,36.938,44,31.016,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FBBC05" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#EA4335" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="none" d="M6,13.5l6,5l6-5L12,2z"></path></svg>
                <span data-translate-key="loginButton">Masuk dengan Google</span>
            </button>
            <p class="text-xs text-gray-500 mt-8" data-translate-key="loginFooter">FocusCut Version 0.2</p>
        </div>
    </div>

    <!-- Main Application Screen -->
    <div id="app-screen" class="hidden p-4 sm:p-6 lg:p-8 min-h-screen flex-col pb-24">
        <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 pb-4 border-b border-white/10">
            <div class="flex items-center gap-4">
                <label for="profile-pic-input" class="cursor-pointer group relative">
                    <img id="profile-pic" src="https://placehold.co/100x100/1e293b/94a3b8?text=User" alt="User Profile" class="w-14 h-14 rounded-full border-2 border-white/20 object-cover group-hover:opacity-60 transition-opacity">
                    <div class="absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><i class="ph-bold ph-pencil-simple text-white text-2xl"></i></div>
                    <div id="profile-pic-loader" class="profile-pic-loader loader hidden"></div>
                </label>
                <input type="file" id="profile-pic-input" class="hidden" accept="image/*">
                <div>
                    <h1 id="company-name-display" class="text-xl sm:text-2xl font-bold text-white">Nama Perusahaan</h1>
                    <p id="user-info" class="text-sm text-gray-300"><span data-translate-key="loggedInAs">Login sebagai</span>: <span id="user-name-display"></span></p>
                </div>
            </div>
            <div class="flex items-center gap-2 sm:gap-4 mt-4 sm:mt-0 w-full sm:w-auto justify-end">
                <button id="edit-profile-btn" class="bg-slate-700/50 hover:bg-slate-600/50 text-white p-2 rounded-full transition-colors" title="Edit Profil"><i class="ph-bold ph-user"></i></button>
                <label for="bg-upload-input" class="cursor-pointer bg-slate-700/50 hover:bg-slate-600/50 text-white p-2 rounded-full transition-colors" title="Ganti Latar Belakang"><i class="ph-bold ph-image"></i></label>
                <input type="file" id="bg-upload-input" class="hidden" accept="image/*">
                
                <!-- PENAMBAHAN: Language Switcher Dropdown -->
                <div class="dropdown">
                    <button class="bg-slate-700/50 hover:bg-slate-600/50 text-white p-2 rounded-full transition-colors" title="Ganti Bahasa"><i class="ph-bold ph-globe"></i></button>
                    <div id="language-dropdown" class="dropdown-content">
                        <a href="#" class="lang-switcher" data-lang="id">🇮🇩 <span data-translate-key="langId">Bahasa Indonesia</span></a>
                        <a href="#" class="lang-switcher" data-lang="en">🇬🇧 <span data-translate-key="langEn">English</span></a>
                    </div>
                </div>

                <button id="logout-btn" class="bg-red-600/80 hover:bg-red-700/80 text-white p-2 rounded-full transition-colors" title="Keluar"><i class="ph-bold ph-sign-out"></i></button>
                <div id="main-actions">
                    <button id="add-task-btn" class="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-300"><i class="ph-bold ph-plus-circle text-xl"></i><span data-translate-key="addProject">Tambah Proyek</span></button>
                    <button id="add-asset-btn" class="hidden items-center gap-2 bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-300"><i class="ph-bold ph-archive text-xl"></i><span data-translate-key="addAsset">Tambah Aset</span></button>
                </div>
            </div>
        </header>

        <nav class="flex space-x-2 mb-6 overflow-x-auto custom-scrollbar pb-2">
            <button id="nav-kanban" data-view="kanban-view" class="nav-btn font-semibold py-2 px-4 rounded-lg transition-colors duration-300 flex-shrink-0"><i class="ph-fill ph-columns mr-1"></i> <span data-translate-key="navProjectBoard">Papan Proyek</span></button>
            <button id="nav-assets" data-view="assets-view" class="nav-btn font-semibold py-2 px-4 rounded-lg transition-colors duration-300 flex-shrink-0"><i class="ph-fill ph-database mr-1"></i> <span data-translate-key="navContentBank">Bank Konten</span></button>
            <button id="nav-invoice" data-view="invoice-view" class="nav-btn font-semibold py-2 px-4 rounded-lg transition-colors duration-300 flex-shrink-0"><i class="ph-fill ph-receipt mr-1"></i> <span data-translate-key="navInvoice">Invoice</span></button>
            <button id="nav-analytics" data-view="analytics-view" class="nav-btn font-semibold py-2 px-4 rounded-lg transition-colors duration-300 flex-shrink-0"><i class="ph-fill ph-chart-bar mr-1"></i> <span data-translate-key="navAnalytics">Analitik</span></button>
        </nav>

        <div class="flex-grow flex flex-col">
            <main id="kanban-view" class="main-view flex flex-col flex-grow">
                 <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <div class="relative flex-grow"><input type="text" id="task-search-input" data-translate-key="searchProjectPlaceholder" placeholder="Cari nama klien, proyek, atau tanggal (YYYY-MM-DD)..." class="w-full bg-slate-800/50 backdrop-blur-sm border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none"><i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i></div>
                    <div class="relative"><select id="task-sort-select" class="w-full md:w-auto appearance-none bg-slate-800/50 backdrop-blur-sm border border-white/10 rounded-lg pl-4 pr-10 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="date_desc" data-translate-key="sortDateDesc">Urutkan: Tanggal (Terbaru)</option>
                        <option value="date_asc" data-translate-key="sortDateAsc">Urutkan: Tanggal (Terlama)</option>
                        <option value="name_az" data-translate-key="sortNameAz">Urutkan: Nama Klien (A-Z)</option>
                        <option value="name_za" data-translate-key="sortNameZa">Urutkan: Nama Klien (Z-A)</option>
                    </select><i class="ph ph-caret-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i></div>
                </div>
                <div class="flex-grow kanban-scroll-container">
                    <button id="scroll-left-btn" class="scroll-btn"><i class="ph-bold ph-caret-left text-2xl"></i></button>
                    <div id="kanban-scroll-wrapper" class="kanban-scroll-wrapper custom-scrollbar">
                        <div id="kanban-board" class="flex flex-row gap-6 pb-4 min-w-max">
                            <div class="glass-panel rounded-xl p-4 flex flex-col w-80 sm:w-96 flex-shrink-0"><h2 class="text-lg font-semibold mb-4 flex justify-between items-center text-cyan-300"><span><i class="ph-fill ph-list-bullets mr-2"></i><span data-translate-key="colContentList">List Konten</span></span><span id="todo-count" class="bg-cyan-800 text-cyan-200 text-xs font-bold px-2 py-1 rounded-full">0</span></h2><div id="todo-column" class="task-column flex-grow overflow-y-auto custom-scrollbar pr-1 min-h-[200px]" data-status="todo"></div></div>
                            <div class="glass-panel rounded-xl p-4 flex flex-col w-80 sm:w-96 flex-shrink-0"><h2 class="text-lg font-semibold mb-4 flex justify-between items-center text-amber-300"><span><i class="ph-fill ph-person-simple-run mr-2"></i><span data-translate-key="colEditing">Proses Editing</span></span><span id="wip-count" class="bg-amber-800 text-amber-200 text-xs font-bold px-2 py-1 rounded-full">0</span></h2><div id="wip-column" class="task-column flex-grow overflow-y-auto custom-scrollbar pr-1 min-h-[200px]" data-status="wip"></div></div>
                            <div class="glass-panel rounded-xl p-4 flex flex-col w-80 sm:w-96 flex-shrink-0"><h2 class="text-lg font-semibold mb-4 flex justify-between items-center text-purple-300"><span><i class="ph-fill ph-eye mr-2"></i><span data-translate-key="colReview">Review / Revisi</span></span><span id="review-count" class="bg-purple-800 text-purple-200 text-xs font-bold px-2 py-1 rounded-full">0</span></h2><div id="review-column" class="task-column flex-grow overflow-y-auto custom-scrollbar pr-1 min-h-[200px]" data-status="review"></div></div>
                            <div class="glass-panel rounded-xl p-4 flex flex-col w-80 sm:w-96 flex-shrink-0"><h2 class="text-lg font-semibold mb-4 flex justify-between items-center text-emerald-300"><span><i class="ph-fill ph-check-circle mr-2"></i><span data-translate-key="colDone">Selesai</span></span><span id="done-count" class="bg-emerald-800 text-emerald-200 text-xs font-bold px-2 py-1 rounded-full">0</span></h2><div id="done-column" class="task-column flex-grow overflow-y-auto custom-scrollbar pr-1 min-h-[200px]" data-status="done"></div></div>
                        </div>
                    </div>
                    <button id="scroll-right-btn" class="scroll-btn"><i class="ph-bold ph-caret-right text-2xl"></i></button>
                </div>
            </main>
            <main id="assets-view" class="main-view hidden flex-grow flex-col"><div class="mb-4 flex flex-col sm:flex-row gap-4"><div class="relative flex-grow"><input type="text" id="asset-search-input" data-translate-key="searchAssetPlaceholder" placeholder="Cari berdasarkan klien, proyek, atau tag..." class="w-full bg-slate-800/50 backdrop-blur-sm border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white focus:ring-2 focus:ring-teal-500 outline-none"><i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i></div></div><div id="assets-grid" class="flex-grow grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto custom-scrollbar pr-2"></div></main>
            <main id="invoice-view" class="main-view hidden flex-grow flex-col">
                <!-- Konten Invoice (tidak diubah untuk brevity) -->
            </main>
            <main id="analytics-view" class="main-view hidden flex-grow flex-col">
                <!-- Konten Analitik (tidak diubah untuk brevity) -->
            </main>
        </div>
    </div>
    
    <!-- Modals & Panels -->
    <!-- PENAMBAHAN: Modal Edit Profil -->
    <div id="edit-profile-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-panel glass-panel rounded-xl shadow-2xl p-6 w-full max-w-md transform scale-95 opacity-0">
            <form id="edit-profile-form">
                <h3 class="text-2xl font-bold mb-4 text-white" data-translate-key="editProfileTitle">Edit Profil</h3>
                <div class="space-y-4">
                    <div>
                        <label for="edit-profile-name-input" class="block text-sm font-medium text-gray-300" data-translate-key="editProfileNameLabel">Nama Pengguna</label>
                        <input type="text" id="edit-profile-name-input" class="mt-1 w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white" required>
                        <p id="edit-profile-error" class="text-red-400 text-sm mt-1 hidden"></p>
                    </div>
                </div>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancel-edit-profile-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-5 rounded-lg" data-translate-key="cancelButton">Batal</button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-5 rounded-lg" data-translate-key="saveButton">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PENAMBAHAN: Modal Pilihan Bahasa -->
    <div id="language-select-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-panel glass-panel rounded-xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-95 opacity-0">
            <i class="ph-bold ph-translate text-5xl text-indigo-400 mb-4"></i>
            <h3 class="text-2xl font-bold text-white mb-2" data-translate-key="langModalTitle">Pilih Bahasa Anda</h3>
            <p class="text-gray-300 mb-6" data-translate-key="langModalSubtitle">You can change this later.</p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button class="lang-selector-btn w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-lg" data-lang="id">🇮🇩 Bahasa Indonesia</button>
                <button class="lang-selector-btn w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-lg" data-lang="en">🇬🇧 English</button>
            </div>
        </div>
    </div>

    <!-- Modal lainnya tidak diubah -->
    <div id="onboarding-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 hidden z-50"><div class="modal-panel glass-panel rounded-xl shadow-2xl p-6 w-full max-w-lg transform scale-95 opacity-0"><form id="onboarding-form"><h3 class="text-2xl font-bold mb-2 text-white">Selamat Datang!</h3><p class="text-gray-300 mb-6">Lengkapi profil Anda untuk mulai.</p><div class="space-y-4"><div><label for="profile-company-name" class="block text-sm font-medium text-gray-300">Nama Perusahaan/Komunitas</label><input type="text" id="profile-company-name" class="mt-1 w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white" required></div><div><label for="profile-field" class="block text-sm font-medium text-gray-300">Bergerak di Bidang</label><input type="text" id="profile-field" placeholder="cth: Video Editor, Agensi Kreatif" class="mt-1 w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"></div><div><label for="profile-contact" class="block text-sm font-medium text-gray-300">Kontak (Email/No. HP)</label><input type="text" id="profile-contact" class="mt-1 w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"></div></div><div class="flex justify-end gap-4 mt-8"><button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-5 rounded-lg flex items-center gap-2"><span>Simpan & Lanjutkan</span><div id="onboarding-loader" class="loader hidden"></div></button></div></form></div></div>
    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50"><div class="modal-panel glass-panel rounded-xl shadow-2xl p-6 w-full max-w-lg transform scale-95 opacity-0"><form id="task-form"><input type="hidden" id="task-id"><h3 id="task-modal-title" class="text-2xl font-bold mb-6">Tambah Proyek Baru</h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4"><div><label for="task-client-name" class="block text-sm font-medium text-gray-300 mb-1">Nama Klien</label><input type="text" id="task-client-name" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white" required></div><div><label for="task-project-type" class="block text-sm font-medium text-gray-300 mb-1">Jenis Proyek</label><input type="text" id="task-project-type" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"></div><div><label for="task-priority" class="block text-sm font-medium text-gray-300 mb-1">Prioritas</label><select id="task-priority" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"><option value="biasa">Biasa</option><option value="penting">Penting</option><option value="mendesak">Mendesak</option></select></div><div><label for="task-deadline" class="block text-sm font-medium text-gray-300 mb-1">Deadline</label><input type="date" id="task-deadline" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"></div><div class="sm:col-span-2"><label for="task-contact" class="block text-sm font-medium text-gray-300 mb-1">Kontak Klien</label><input type="text" id="task-contact" placeholder="Email atau No. HP" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"></div></div><div class="mb-6"><label for="brief" class="block text-sm font-medium text-gray-300 mb-1">Brief / Catatan</label><textarea id="brief" rows="3" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white"></textarea></div><div class="flex justify-end gap-4"><button type="button" id="cancel-task-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-5 rounded-lg">Batal</button><button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-5 rounded-lg">Simpan</button></div></form></div></div>
    <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50"><div class="modal-panel glass-panel rounded-xl shadow-2xl p-6 w-full max-w-sm text-center transform scale-95 opacity-0"><h3 class="text-lg font-bold text-white mb-2">Yakin ingin menghapus?</h3><p id="delete-item-name" class="text-gray-300 mb-6"></p><div class="flex justify-center gap-4"><button id="cancel-delete-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg">Batal</button><button id="confirm-delete-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg">Hapus</button></div></div></div>
    <div id="comments-panel-overlay" class="fixed inset-0 bg-black bg-opacity-70 hidden z-40"></div>
    <div id="comments-panel" class="side-panel glass-panel fixed top-0 right-0 h-full w-full max-w-md shadow-2xl transform translate-x-full z-50 flex flex-col"><div class="flex justify-between items-center p-4 border-b border-white/10 flex-shrink-0"><h3 id="comments-task-title" class="text-lg font-bold text-white truncate pr-4">Komentar</h3><button id="close-comments-btn" class="p-2 text-gray-400 hover:text-white"><i class="ph-bold ph-x text-xl"></i></button></div><div id="comments-list" class="flex-grow p-4 overflow-y-auto custom-scrollbar"></div><div class="p-4 border-t border-white/10 flex-shrink-0"><form id="comment-form" class="flex gap-2"><input type="text" id="comment-input" class="w-full bg-slate-700/50 border border-white/10 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Tulis komentar..." required><button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg flex items-center justify-center"><i class="ph-bold ph-paper-plane-tilt text-xl"></i></button></form></div></div>
    <div id="focus-bar" class="fixed bottom-0 left-0 right-0 glass-panel shadow-lg"><div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-2 grid grid-cols-2 md:grid-cols-3 items-center gap-4"><div class="flex items-center gap-3 justify-start"><i class="ph-bold ph-timer text-xl text-yellow-400"></i><span class="font-semibold text-white hidden sm:inline">Editor Focus</span><span id="timer-display" class="text-lg font-mono bg-slate-900/70 text-white px-2 py-0.5 rounded-md">30:00</span></div><div class="hidden md:flex flex-col items-center justify-center"><div class="w-full max-w-xs bg-slate-600/50 rounded-full h-2.5"><div id="timer-progress" class="bg-yellow-400 h-2.5 rounded-full" style="width: 100%;"></div></div></div><div class="flex items-center gap-4 justify-end">
        <div class="text-xs text-gray-500 hidden lg:block">FocusCut Version 0.2</div>
        <div class="flex items-center gap-2"><button id="start-timer-btn" class="bg-green-600 hover:bg-green-700 text-white p-2 rounded-full transition-colors"><i class="ph-bold ph-play"></i></button><button id="pause-timer-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded-full transition-colors hidden"><i class="ph-bold ph-pause"></i></button><button id="reset-timer-btn" class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-full transition-colors"><i class="ph-bold ph-arrow-counter-clockwise"></i></button></div></div></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- KONFIGURASI FIREBASE (TIDAK DIUBAH) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCxeKFNLJurJd108Cfnotygm6FI9Mr9sQY",
            authDomain: "dashboard-editor-dermapro-sf.firebaseapp.com",
            databaseURL: "https://dashboard-editor-dermapro-sf-default-rtdb.firebaseio.com",
            projectId: "dashboard-editor-dermapro-sf",
            storageBucket: "dashboard-editor-dermapro-sf.appspot.com",
            messagingSenderId: "43085432214",
            appId: "1:43085432214:web:2548f67ecbff42e32b49b7",
            measurementId: "G-2M6VJTPYSN"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- GLOBAL STATE ---
        let currentUser = null;
        let userProfileData = {};
        let allTasksCache = [];
        let allAssetsCache = [];
        let unsubscribeComments = null;
        let currentLanguage = 'id'; // Default ke Bahasa Indonesia

        // PENAMBAHAN: Objek untuk terjemahan
        const translations = {
            en: {
                productName: "FocusCut",
                loginSubtitle: "Sign in to continue to your dashboard.",
                loginButton: "Sign in with Google",
                loginFooter: "FocusCut Version 0.2",
                loggedInAs: "Logged in as",
                addProject: "Add Project",
                addAsset: "Add Asset",
                navProjectBoard: "Project Board",
                navContentBank: "Content Bank",
                navInvoice: "Invoice",
                navAnalytics: "Analytics",
                sortDateDesc: "Sort by: Date (Newest)",
                sortDateAsc: "Sort by: Date (Oldest)",
                sortNameAz: "Sort by: Client Name (A-Z)",
                sortNameZa: "Sort by: Client Name (Z-A)",
                colContentList: "Content List",
                colEditing: "Editing Process",
                colReview: "Review / Revision",
                colDone: "Done",
                editProfileTitle: "Edit Profile",
                editProfileNameLabel: "Username",
                cancelButton: "Cancel",
                saveButton: "Save",
                langModalTitle: "Choose Your Language",
                langModalSubtitle: "You can change this later.",
                langId: "Indonesian",
                langEn: "English",
                searchProjectPlaceholder: "Search by client, project, or date (YYYY-MM-DD)...",
                searchAssetPlaceholder: "Search by client, project, or tags...",
            },
            id: {
                productName: "FocusCut",
                loginSubtitle: "Masuk untuk melanjutkan ke dasbor Anda.",
                loginButton: "Masuk dengan Google",
                loginFooter: "FocusCut Version 0.2",
                loggedInAs: "Login sebagai",
                addProject: "Tambah Proyek",
                addAsset: "Tambah Aset",
                navProjectBoard: "Papan Proyek",
                navContentBank: "Bank Konten",
                navInvoice: "Invoice",
                navAnalytics: "Analitik",
                sortDateDesc: "Urutkan: Tanggal (Terbaru)",
                sortDateAsc: "Urutkan: Tanggal (Terlama)",
                sortNameAz: "Urutkan: Nama Klien (A-Z)",
                sortNameZa: "Urutkan: Nama Klien (Z-A)",
                colContentList: "List Konten",
                colEditing: "Proses Editing",
                colReview: "Review / Revisi",
                colDone: "Selesai",
                editProfileTitle: "Edit Profil",
                editProfileNameLabel: "Nama Pengguna",
                cancelButton: "Batal",
                saveButton: "Simpan",
                langModalTitle: "Pilih Bahasa Anda",
                langModalSubtitle: "Anda dapat mengubah ini nanti.",
                langId: "Bahasa Indonesia",
                langEn: "English",
                searchProjectPlaceholder: "Cari nama klien, proyek, atau tanggal (YYYY-MM-DD)...",
                searchAssetPlaceholder: "Cari berdasarkan klien, proyek, atau tag...",
            }
        };

        // --- ELEMEN UTAMA ---
        const loginScreen = document.getElementById('login-screen');
        const appScreen = document.getElementById('app-screen');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const loginErrorMsg = document.getElementById('login-error-message');

        // --- FUNGSI MODAL HELPER ---
        const openModal = (modalElement) => { if (modalElement) { modalElement.classList.remove('hidden'); setTimeout(() => { if (modalElement.firstElementChild) modalElement.firstElementChild.classList.remove('scale-95', 'opacity-0'); }, 10); }};
        const closeModal = (modalElement) => { if (modalElement) { if (modalElement.firstElementChild) modalElement.firstElementChild.classList.add('scale-95', 'opacity-0'); setTimeout(() => modalElement.classList.add('hidden'), 300); }};

        // --- LOGIKA OTENTIKASI (TIDAK DIUBAH) ---
        const provider = new firebase.auth.GoogleAuthProvider();
        googleLoginBtn.addEventListener('click', () => {
            auth.signInWithPopup(provider).catch((error) => {
                console.error("Firebase Login Error:", error);
                loginErrorMsg.textContent = `Error: ${error.message}`;
                loginErrorMsg.classList.remove('hidden');
            });
        });

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                const whitelistRef = db.collection('whitelisted_users').doc(user.email);
                try {
                    const doc = await whitelistRef.get();
                    if (doc.exists) {
                        userProfileData = doc.data();
                        startAppFlow(user, userProfileData);
                    } else {
                        loginErrorMsg.textContent = "Akses ditolak. Email Anda tidak terdaftar.";
                        loginErrorMsg.classList.remove('hidden');
                        await auth.signOut();
                    }
                } catch (error) {
                    console.error("ERROR saat get() dari Firestore:", error);
                    loginErrorMsg.textContent = "Gagal memverifikasi akun. Cek aturan keamanan Firestore.";
                    loginErrorMsg.classList.remove('hidden');
                    await auth.signOut();
                }
            } else {
                currentUser = null;
                loginScreen.style.display = 'flex';
                appScreen.style.display = 'none';
            }
        });

        // --- FUNGSI ALUR APLIKASI UTAMA ---
        function startAppFlow(user, profileData) {
            loginScreen.style.display = 'none';
            if (profileData && profileData.companyName) {
                initializeAppUI(user, profileData);
                // PENAMBAHAN: Cek bahasa setelah UI diinisialisasi
                if (profileData.language) {
                    setLanguage(profileData.language);
                } else {
                    openModal(document.getElementById('language-select-modal'));
                }
            } else {
                appScreen.style.display = 'none'; 
                openModal(document.getElementById('onboarding-modal'));
                setupOnboarding(user, profileData || {});
            }
        }
        
        // PENAMBAHAN: Fungsi untuk menerjemahkan UI
        function translateUI() {
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                const translation = translations[currentLanguage][key];
                if (translation) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translation;
                    } else {
                        el.textContent = translation;
                    }
                }
            });
            // Update judul tab
            document.title = translations[currentLanguage].productName;
        }

        // PENAMBAHAN: Fungsi untuk mengatur bahasa
        function setLanguage(lang) {
            currentLanguage = lang;
            if (currentUser) {
                db.collection('whitelisted_users').doc(currentUser.email).update({ language: lang })
                  .catch(err => console.error("Gagal menyimpan preferensi bahasa:", err));
            }
            translateUI();
        }

        function setupOnboarding(user, existingData) {
            const onboardingForm = document.getElementById('onboarding-form');
            onboardingForm.onsubmit = async (e) => {
                e.preventDefault();
                const newProfileData = {
                    ...existingData, uid: user.uid, displayName: user.displayName, email: user.email, photoURL: user.photoURL,
                    companyName: document.getElementById('profile-company-name').value,
                    field: document.getElementById('profile-field').value,
                    contact: document.getElementById('profile-contact').value,
                    profileCompletedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                try {
                    await db.collection('whitelisted_users').doc(user.email).update(newProfileData);
                    closeModal(document.getElementById('onboarding-modal'));
                    initializeAppUI(user, newProfileData);
                    // PENAMBAHAN: Tampilkan pilihan bahasa setelah onboarding
                    openModal(document.getElementById('language-select-modal'));
                } catch (error) {
                    console.error("Gagal memperbarui profil:", error);
                }
            };
        }

        // --- FUNGSI INISIALISASI UI UTAMA ---
        function initializeAppUI(user, profileData) {
            appScreen.style.display = 'flex';
            document.getElementById('company-name-display').textContent = profileData.companyName || 'Nama Perusahaan';
            document.getElementById('user-name-display').textContent = profileData.displayName || user.displayName;
            document.getElementById('profile-pic').src = profileData.photoURL || user.photoURL || 'https://placehold.co/100x100/1e293b/94a3b8?text=User';
            if (profileData.backgroundURL) {
                document.body.style.backgroundImage = `url('${profileData.backgroundURL}')`;
            }

            document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
            setupProfilePicUpload(user, profileData);
            setupBgUpload(user);
            setupNavigation();
            setupModals(user);
            setupKanbanInteractions(user, profileData);
            setupAssetInteractions();
            setupCommentSubmission(user, profileData);
            setupTimer();
            setupTaskSearchAndSort();
            setupAssetSearch();
            // PENAMBAHAN: Setup untuk fitur baru
            setupLanguageSwitcher();
            setupEditProfile(user, profileData);
            
            listenToTasks(user.uid);
            listenToAssets(user.uid);
        }
        
        // --- PENAMBAHAN: Setup Fitur Edit Profil ---
        function setupEditProfile(user, profileData) {
            const editProfileModal = document.getElementById('edit-profile-modal');
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const cancelBtn = document.getElementById('cancel-edit-profile-btn');
            const form = document.getElementById('edit-profile-form');
            const nameInput = document.getElementById('edit-profile-name-input');
            const errorMsg = document.getElementById('edit-profile-error');

            editProfileBtn.addEventListener('click', () => {
                nameInput.value = userProfileData.displayName || '';
                errorMsg.classList.add('hidden');
                openModal(editProfileModal);
            });

            cancelBtn.addEventListener('click', () => closeModal(editProfileModal));

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newName = nameInput.value.trim();
                if (!newName) {
                    errorMsg.textContent = "Nama tidak boleh kosong.";
                    errorMsg.classList.remove('hidden');
                    return;
                }
                
                try {
                    await db.collection('whitelisted_users').doc(user.email).update({ displayName: newName });
                    userProfileData.displayName = newName; // Update local state
                    document.getElementById('user-name-display').textContent = newName; // Update UI
                    closeModal(editProfileModal);
                } catch (error) {
                    console.error("Gagal update nama:", error);
                    errorMsg.textContent = "Gagal menyimpan perubahan. Coba lagi.";
                    errorMsg.classList.remove('hidden');
                }
            });
        }

        // --- PENAMBAHAN: Setup Fitur Pilihan Bahasa ---
        function setupLanguageSwitcher() {
            const langModal = document.getElementById('language-select-modal');
            
            // Listener untuk tombol di modal
            document.querySelectorAll('.lang-selector-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    setLanguage(btn.dataset.lang);
                    closeModal(langModal);
                });
            });

            // Listener untuk dropdown di header
            document.querySelectorAll('.lang-switcher').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    setLanguage(link.dataset.lang);
                });
            });
        }

        // --- FUNGSI SEARCH & SORT (Tidak diubah) ---
        function setupTaskSearchAndSort() { /* ... */ }
        function filterAndSortTasks() { /* ... */ }
        function setupAssetSearch() { /* ... */ }
        function filterAssets() { /* ... */ }

        // --- FUNGSI RENDER & LISTENER (Tidak diubah) ---
        function listenToTasks(uid) { /* ... */ }
        function renderAllTasks(tasksToRender) { /* ... */ }
        function listenToAssets(uid) { /* ... */ }
        function renderAllAssets(assetsToRender) { /* ... */ }
        
        // --- FUNGSI LAINNYA (Tidak diubah, hanya memastikan terjemahan dipanggil) ---
        function setupTimer() {
            // ... (logika timer)
            // Pastikan judul tab diupdate dengan bahasa yang benar
            const updateTimerDisplay = () => {
                // ...
                const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timerDisplay.textContent = timeString;
                const baseTitle = translations[currentLanguage].productName || 'FocusCut';
                document.title = isTimerRunning ? `${timeString} - ${baseTitle}` : baseTitle;
            };
            // ...
        }
        
        // Sisa fungsi tidak perlu diubah secara signifikan
        function setupKanbanInteractions(user, profileData) { /* ... */ }
        function setupAssetInteractions() { /* ... */ }
        function setupCommentSubmission(user, profileData) { /* ... */ }
        function setupModals(user) { /* ... */ }
        function setupNavigation() { /* ... */ }
        function setupProfilePicUpload(user, profileData) { /* ... */ }
        function setupBgUpload(user) { /* ... */ }

        // Panggil terjemahan awal saat load, untuk halaman login
        translateUI();
    });
    </script>
</body>
</html>
